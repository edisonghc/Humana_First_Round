sheet = "Rx Utilization")
## Format data
claims = claims_df %>%
pivot_longer(-id, names_to = "time", values_to = "agg_claim") %>%
transmute(id = as.character(id),
time = excel_numeric_to_date(as.numeric(time),
date_system = "modern" ),
agg_claim)
er = er_df %>%
pivot_longer(-id, names_to = "time", values_to = "count") %>%
transmute(id = as.character(id),
time = excel_numeric_to_date(as.numeric(time),
date_system = "modern" ),
er_count = count)
pcp = pcp_df %>%
pivot_longer(-id, names_to = "time", values_to = "count") %>%
transmute(id = as.character(id),
time = excel_numeric_to_date(as.numeric(time),
date_system = "modern" ),
pcp_count = count)
hospital = hospital_df %>%
pivot_longer(-id, names_to = "time", values_to = "count") %>%
transmute(id = as.character(id),
time = excel_numeric_to_date(as.numeric(time),
date_system = "modern" ),
hospital_count = count)
rx = rx_df %>%
pivot_longer(-id, names_to = "time", values_to = "count") %>%
transmute(id = as.character(id),
time = excel_numeric_to_date(as.numeric(time),
date_system = "modern" ),
rx_count = count)
## Check counts
er %>% group_by(er_count) %>%
count() %>% arrange()
pcp %>% group_by(pcp_count) %>%
count() %>% arrange()
hospital %>% group_by(hospital_count) %>%
count() %>% arrange()
rx %>% group_by(rx_count) %>%
count() %>% arrange()
claims %>% group_by(agg_claim) %>%
count() %>% arrange() # assume mistyped a minus sign in front
## Check: each individual either get one or none CRD
demo_df %>% mutate(test_sum = transport+fin_assis+lonely+food_insec) %>%
filter(test_sum > 1)
## Check: region
demo_df %>% group_by(region) %>%
count() %>% arrange(n) # unknown small, ignore
## Check: rural
demo_df %>% group_by(rural) %>%
count() %>% arrange(n) # unknown small, ignore
## Check: is_lowincome
demo_df %>% group_by(is_lowincome) %>%
count() %>% arrange(n) # inconsistant label, need to fix
## Check: age
demo_df %>% group_by(age) %>% count() %>% filter(age<5) %>% arrange(age) # need to correct negative values, assume mistyped minues sign
demo_df %>% group_by(age) %>% count() %>% filter(age>95) %>% arrange(age) # need to correct >100 values, assume mistyped a 1 in the front
## Check: chronic_count
demo_df %>% group_by(chronic_count) %>% count() %>% arrange(chronic_count) # assume mistyped a 1 in the front
## Check: gender
demo_df %>% group_by(gender) %>% count() %>% arrange(n) # will just ignore other than M, F
demo = demo_df %>%
mutate(is_lowincome = demo_df$is_lowincome %in% c("Y","Yes","YES"),
age = ifelse(age>110, age-100, abs(age)),
mth_out = decimal_date(mdy(paste(mth_out,"1","2017"))),
chronic_count = ifelse(chronic_count>=10,
chronic_count-10,
chronic_count)) %>%
filter(region != "Unknown" & rural != "Unknown" & gender %in% c("M","F"))
## Add a column indicate which CRD an individual received
crd = NA
for(i in 1:length(demo$id)){
crd[i]=0
if(demo$transport[i] == 1){
crd[i] = 1
}
if(demo$fin_assis[i] == 1){
crd[i] = 2
}
if(demo$lonely[i] == 1){
crd[i] = 3
}
if(demo$food_insec[i] == 1){
crd[i] = 4
}
}
demo = demo %>% cbind(crd)
## Check: all NAs represent people from the control group
demo_df %>% filter(is.na(mth_out),
crd ==0)
## Join utilization and claim tables
loss = er %>%
inner_join(hospital, by = c("id"="id","time"="time")) %>%
inner_join(pcp, by = c("id"="id","time"="time")) %>%
inner_join(rx, by = c("id"="id","time"="time")) %>%
mutate(total_count = er_count+hospital_count+pcp_count+rx_count) %>%
inner_join(claims, by = c("id"="id","time"="time")) %>%
mutate(agg_claim = abs(agg_claim),
avg_claim = ifelse(agg_claim*total_count!=0,agg_claim/total_count,0))
## Convert date to decimal year
loss = loss %>% mutate(time = decimal_date(time))
## Reduction
demo = demo %>%
select(id,region,rural,is_lowincome,age,chronic_count,gender,mth_out,crd)
remove(claims,claims_df,demo_df,er,er_df,hospital,hospital_df,pcp,pcp_df,rx,rx_df,crd,i)
## Join demo(features) with loss(responses)
impact = demo %>% inner_join(loss)
## Add a column to indicate if row is after_crd
impact = impact %>%
mutate(after_crd = ifelse(!is.na(mth_out),time >= mth_out,NA))
#impact = impact %>% select(-mth_out)
out = sort(unique(impact$mth_out))
before=list()
after=list()
for(i in 1:length(out)){
tmp = impact %>% filter(mth_out==out[i])
before[[i]] = tmp %>% filter(after_crd==F)
#write.csv(before[[i]],paste('before_received_crd_in_month_',i,'.csv'))
after[[i]] = tmp %>% filter(after_crd==T)
#rite.csv(after[[i]],paste('after_received_crd_in_month_',i,'.csv'))
}
control = impact %>% filter(is.na(mth_out))
attach(control)
model1 = lm(log(agg_claim+1)~er_count+hospital_count+rx_count+pcp_count)
summary(model1)
attach(control)
model1 = lm(log(agg_claim+1)~er_count+hospital_count+rx_count+pcp_count+time)
summary(model1)
attach(control)
model1 = lm(log(agg_claim+1)~er_count*hospital_count*rx_count*pcp_count+time)
summary(model1)
model1 = lm(log(agg_claim+1)~er_count*hospital_count*rx_count*pcp_count*time)
attach(control)
model1 = lm(log(agg_claim+1)~er_count*hospital_count*rx_count*pcp_count*time)
summary(model1)
attach(control)
model1 = lm(log(agg_claim+1)~er_count*hospital_count*rx_count*pcp_count+time+gender)
summary(model1)
attach(control)
model1 = lm(log(agg_claim+1)~er_count*hospital_count*rx_count*pcp_count+time+gender)
summary(model1)
plot(control, fitted(model1), residuals(model1))
attach(control)
tmp = control
model1 = lm(log(agg_claim+1)~er_count*hospital_count*rx_count*pcp_count+time+gender)
summary(model1)
tmm = tmp %>% cbind(fit = fitted(model1),res = residuals(model1))
ggplot(data=tmp) + geom_point(mapping=aes(x=fit,y=res,color=factor(crd)))
attach(control)
tmp = control
model1 = lm(log(agg_claim+1)~er_count*hospital_count*rx_count*pcp_count+time+gender)
summary(model1)
tmm = tmp %>% cbind(fit = fitted(model1),res = residuals(model1))
ggplot(data=tmp) + geom_point(mapping=aes(x=fit,y=res))
attach(control)
tmp = control
model1 = lm(log(agg_claim+1)~er_count*hospital_count*rx_count*pcp_count+time+gender)
summary(model1)
tmp = tmp %>% cbind(fit = fitted(model1),res = residuals(model1))
ggplot(data=tmp) + geom_point(mapping=aes(x=fit,y=res))
ggplot(data=tmp) + geom_point(mapping=aes(x=fit,y=res))
attach(control)
tmp = control
model1 = lm(log(agg_claim+1)~er_count*hospital_count*rx_count*pcp_count+time+gender)
summary(model1)
tmp = tmp %>% cbind(fit = fitted(model1),res = residuals(model1))
ggplot(data=tmp) + geom_point(mapping=aes(x=fit,y=res,color=region))
ggplot(data=tmp) + geom_point(mapping=aes(x=fit,y=res))
attach(control)
tmp = control
model1 = lm(log(agg_claim+1)~er_count*hospital_count*rx_count*pcp_count+time+gender)
summary(model1)
tmp = tmp %>% cbind(fit = fitted(model1),res = residuals(model1))
ggplot(data=tmp) + geom_point(mapping=aes(x=fit,y=res,color=region))
ggplot(data=tmp) + geom_point(mapping=aes(x=time,y=res))
attach(control)
tmp = control
model1 = lm(log(agg_claim+1)~er_count*hospital_count*rx_count*pcp_count+time+gender)
summary(model1)
tmp = tmp %>% cbind(fit = fitted(model1),res = residuals(model1))
#ggplot(data=tmp) + geom_point(mapping=aes(x=fit,y=res,color=region))
ggplot(data=tmp) + geom_point(mapping=aes(x=region,y=res))
attach(control)
tmp = control
model1 = lm(log(agg_claim+1)~er_count*hospital_count*rx_count*pcp_count+time+gender)
summary(model1)
tmp = tmp %>% cbind(fit = fitted(model1),res = residuals(model1))
#ggplot(data=tmp) + geom_point(mapping=aes(x=fit,y=res,color=region))
ggplot(data=tmp) + geom_boxplot(mapping=aes(x=,y=res))
attach(control)
tmp = control
model1 = lm(log(agg_claim+1)~er_count*hospital_count*rx_count*pcp_count+time+gender)
summary(model1)
tmp = tmp %>% cbind(fit = fitted(model1),res = residuals(model1))
#ggplot(data=tmp) + geom_point(mapping=aes(x=fit,y=res,color=region))
ggplot(data=tmp) + geom_boxplot(mapping=aes(x=region,y=res))
attach(control)
tmp = control
model1 = lm(log(agg_claim+1)~er_count*hospital_count*rx_count*pcp_count+time+gender)
summary(model1)
tmp = tmp %>% cbind(fit = fitted(model1),res = residuals(model1))
#ggplot(data=tmp) + geom_point(mapping=aes(x=fit,y=res,color=region))
ggplot(data=tmp) + geom_boxplot(mapping=aes(x=gender,y=res))
attach(control)
tmp = control
model1 = lm(log(agg_claim+1)~er_count*hospital_count*rx_count*pcp_count+time+gender)
summary(model1)
tmp = tmp %>% cbind(fit = fitted(model1),res = residuals(model1))
#ggplot(data=tmp) + geom_point(mapping=aes(x=fit,y=res,color=region))
ggplot(data=tmp) + geom_boxplot(mapping=aes(x=rural,y=res))
#ggplot(data=tmp) + geom_point(mapping=aes(x=fit,y=res,color=region))
ggplot(data=tmp) + geom_boxplot(mapping=aes(x=is_lowincome,y=res))
attach(control)
tmp = control
model1 = lm(log(agg_claim+1)~er_count*hospital_count*rx_count*pcp_count+time+gender)
summary(model1)
tmp = tmp %>% cbind(fit = fitted(model1),res = residuals(model1))
#ggplot(data=tmp) + geom_point(mapping=aes(x=fit,y=res,color=region))
ggplot(data=tmp) + geom_boxplot(mapping=aes(x=is_lowincome,y=res))
ggplot(data=tmp,mapping=aes(x=is_lowincome,y=res)) + geom_point()+geom_jitter()
attach(control)
tmp = control
model1 = lm(log(agg_claim+1)~er_count*hospital_count*rx_count*pcp_count+time+gender)
summary(model1)
tmp = tmp %>% cbind(fit = fitted(model1),res = residuals(model1))
#ggplot(data=tmp) + geom_point(mapping=aes(x=fit,y=res,color=region))
ggplot(data=tmp) + geom_boxplot(mapping=aes(x=is_lowincome,y=res))
ggplot(data=tmp,mapping=aes(x=is_lowincome,y=res),alpha=0.2) + geom_point()+geom_jitter()
attach(control)
tmp = control
model1 = lm(log(agg_claim+1)~er_count*hospital_count*rx_count*pcp_count+time+gender)
summary(model1)
tmp = tmp %>% cbind(fit = fitted(model1),res = residuals(model1))
#ggplot(data=tmp) + geom_point(mapping=aes(x=fit,y=res,color=region))
ggplot(data=tmp) + geom_boxplot(mapping=aes(x=is_lowincome,y=res))
ggplot(data=tmp,mapping=aes(x=is_lowincome,y=res)) + geom_point()+geom_jitter(alpha=0.2)
attach(control)
tmp = control
model1 = lm(log(agg_claim+1)~er_count*hospital_count*rx_count*pcp_count+time+gender)
summary(model1)
tmp = tmp %>% cbind(fit = fitted(model1),res = residuals(model1))
#ggplot(data=tmp) + geom_point(mapping=aes(x=fit,y=res,color=region))
ggplot(data=tmp) + geom_boxplot(mapping=aes(x=is_lowincome,y=res))
ggplot(data=tmp,mapping=aes(x=is_lowincome,y=res,color=gender)) + geom_jitter(alpha=0.2)
ggplot(data=tmp,mapping=aes(x=is_lowincome,y=res,color=rural)) + geom_jitter(alpha=0.2)
ggplot(data=tmp,mapping=aes(x=is_lowincome,y=res,color=region)) + geom_jitter(alpha=0.2)
ggplot(data=tmp,mapping=aes(x=is_lowincome,y=res,color=factor(chronic_count))) + geom_jitter(alpha=0.2)
#ggplot(data=tmp) + geom_point(mapping=aes(x=fit,y=res,color=region))
ggplot(data=tmp) + geom_boxplot(mapping=aes(x=factor(chronic_count),y=res))
#ggplot(data=tmp) + geom_point(mapping=aes(x=fit,y=res,color=region))
ggplot(data=tmp) + geom_boxplot(mapping=aes(x=factor(chronic_count),y=res))
ggplot(data=tmp,mapping=aes(x=is_lowincome,y=res,color=factor(chronic_count))) + geom_jitter(alpha=0.2)
ggplot(data=tmp,mapping=aes(x=factor(chronic_count),y=res)) + geom_jitter(alpha=0.2)
ggplot(data=tmp) + geom_point(mapping=aes(x=time,y=factor(chronic_count)))
ggplot(data=tmp) + geom_jitter(mapping=aes(x=time,y=factor(chronic_count)))
ggplot(data=tmp) + geom_jitter(mapping=aes(x=time,y=factor(chronic_count)),alpha=0.2)
ggplot(data=tmp) + geom_bar(aes(x=factor(chronic_count)))
ggplot(data=tmp,mapping=aes(x=factor(chronic_count),y=res)) + geom_jitter(alpha=0.2)
ggplot(data=tmp) + geom_jitter(mapping=aes(x=age,y=factor(chronic_count)),alpha=0.2)
ggplot(data=tmp) + geom_jitter(mapping=aes(x=age,y=factor(chronic_count)),alpha=0.1)
ggplot(data=tmp) + geom_boxplot(mapping=aes(x=age,y=res))
ggplot(data=tmp) + geom_boxplot(mapping=aes(x=factor(age),y=res))
ggplot(data=tmp,mapping=aes(x=age,y=res)) + geom_jitter(alpha=0.2)
ggplot(data=tmp,mapping=aes(x=age,y=res)) + geom_point(alpha=0.2)
model1 = lm(log(agg_claim+1)~er_count*hospital_count*rx_count*pcp_count+
time+gender+age*factor(chronic_count))
summary(model1)
tmp = tmp %>% cbind(fit = fitted(model1),res = residuals(model1))
tmp = control
tmp = tmp %>% cbind(fit = fitted(model1),res = residuals(model1))
ggplot(data=tmp) + geom_boxplot(mapping=aes(x=factor(chronic_count),y=res))
ggplot(data=tmp) + geom_boxplot(mapping=aes(x=factor(age),y=res))
ggplot(data=tmp,mapping=aes(x=age,y=res)) + geom_point(alpha=0.2)
ggplot(data=tmp,mapping=aes(x=age,y=res)) + geom_point(alpha=0.2)
ggplot(data=tmp,mapping=aes(x=age,y=res)) + geom_point(alpha=0.1)
ggplot(data=tmp,mapping=aes(x=factor(chronic_count),y=res)) + geom_point(alpha=0.1)
ggplot(data=tmp,mapping=aes(x=factor(chronic_count),y=res)) + geom_jitter(alpha=0.1)
ggplot(data=tmp) + geom_density(aes(x=age))
ggplot(data=tmp) + geom_bar(aes(x=factor(chronic_count)))
ggplot(data = tmp) +
geom_point(mapping = aes(x = time, y = log_claim),alpha=0.1) +
facet_grid(rows = vars(time), cols = vars(factor(chronic_count)))
control %>% filter(er_count>0hospital_count>0)
?switch
ggplot(data = tmp) +
geom_point(mapping = aes(x = time, y = log_claim),alpha=0.1) +
facet_grid(rows = vars(cut(time,c(0,20,40,60,80,100,120))), cols = vars(factor(chronic_count)))
ggplot(data = tmp) +
geom_point(mapping = aes(x = time, y = log(agg_claim+1)),alpha=0.1) +
facet_grid(rows = vars(cut(time,c(0,20,40,60,80,100,120))), cols = vars(factor(chronic_count)))
?cut
cut(time,c(0,20,40,60,80,100,120)
)
ggplot(data = tmp) +
geom_point(mapping = aes(x = time, y = log(agg_claim+1)),alpha=0.1) +
facet_grid(rows = vars(cut(age,c(0,20,40,60,80,100,120))), cols = vars(factor(chronic_count)))
ggplot(data = tmp) +
geom_point(mapping = aes(x = fit, y = res),alpha=0.1) +
facet_grid(rows = vars(cut(age,c(0,20,40,60,80,100,120))), cols = vars(factor(chronic_count)))
ggplot(data=tmp) + geom_point(mapping=aes(x=fit,y=res,color=region))
ggplot(data=tmp) + geom_point(mapping=aes(x=fit,y=res,color=region),alpha=0.5)
tmp = control
log_claim = log(tmp$agg_claim)
#tmp %>% ggplot() + geom_density(aes(x=log_claim))
#tmp %>% ggplot() + geom_bar(aes(x=total_count))
a =
tmp %>% filter(er_count>0) %>%
ggplot() + geom_point(aes(x=time,y=log(agg_claim),color=factor(er_count)),alpha=0.3) + ylim(4,10)
tmp %>% filter(hospital_count>0) %>%
ggplot() + geom_point(aes(x=time,y=log(agg_claim),color=factor(hospital_count)),alpha=0.3)+ ylim(4,10)
tmp %>% filter(rx_count>0) %>%
ggplot() + geom_point(aes(x=time,y=log(agg_claim),color=factor(rx_count)),alpha=0.3)+ ylim(4,10)
tmp %>% filter(pcp_count>0) %>%
ggplot() + geom_point(aes(x=time,y=log(agg_claim),color=factor(pcp_count)),alpha=0.3)+ ylim(4,10)
ggplot(data = tmp) +
geom_point(mapping = aes(x = time, y = log_claim),alpha=0.1) +
facet_grid(rows = vars(er_count), cols = vars(rx_count))
ggplot(data = tmp) +
geom_point(mapping = aes(x = time, y = log_claim),alpha=0.1) +
facet_grid(rows = vars(rx_count), cols = vars(er_count))
tmp = control
log_claim = log(tmp$agg_claim)
#tmp %>% ggplot() + geom_density(aes(x=log_claim))
#tmp %>% ggplot() + geom_bar(aes(x=total_count))
tmp %>% filter(er_count>0) %>%
ggplot() + geom_point(aes(x=time,y=log(agg_claim),color=factor(er_count)),alpha=0.3) + ylim(4,10)
tmp %>% filter(hospital_count>0) %>%
ggplot() + geom_point(aes(x=time,y=log(agg_claim),color=factor(hospital_count)),alpha=0.3)+ ylim(4,10)
tmp %>% filter(rx_count>0) %>%
ggplot() + geom_point(aes(x=time,y=log(agg_claim),color=factor(rx_count)),alpha=0.3)+ ylim(4,10)
tmp %>% filter(pcp_count>0) %>%
ggplot() + geom_point(aes(x=time,y=log(agg_claim),color=factor(pcp_count)),alpha=0.3)+ ylim(4,10)
ggplot(data = tmp) +
geom_point(mapping = aes(x = time, y = log_claim),alpha=0.1) +
facet_grid(rows = vars(er_count), cols = vars(rx_count))
ggplot(data = tmp) +
geom_point(mapping = aes(x = time, y = log_claim),alpha=0.1) +
facet_grid(rows = vars(rx_count), cols = vars(er_count))
tmp = control
tmp = tmp %>% mutate(er_claim = ifelse((er_count>0)&(hospital_count*pcp_count*rx_count==0),
agg_claim/er_claim,
avg_claim),
hospital_claim = ifelse((hospital_count>0)&(er_count*pcp_count*rx_count==0),
agg_claim/hospital_claim,
avg_claim),
pcp_claim = ifelse((pcp_count>0)&(er_count*hospital_count*rx_count==0),
agg_claim/pcp_claim,
avg_claim),
rx_claim = ifelse((rx_count>0)&(hospital_count*pcp_count*pcp_count==0),
agg_claim/rx_claim,
avg_claim))
tmp = control
tmp = tmp %>% summarize(er_claim = ifelse((er_count>0)&(hospital_count*pcp_count*rx_count==0),
agg_claim/er_claim,
avg_claim),
hospital_claim = ifelse((hospital_count>0)&(er_count*pcp_count*rx_count==0),
agg_claim/hospital_claim,
avg_claim),
pcp_claim = ifelse((pcp_count>0)&(er_count*hospital_count*rx_count==0),
agg_claim/pcp_claim,
avg_claim),
rx_claim = ifelse((rx_count>0)&(hospital_count*pcp_count*pcp_count==0),
agg_claim/rx_claim,
avg_claim))
tmp = control
tmp = tmp %>% cbind(er_claim = ifelse((er_count>0)&(hospital_count*pcp_count*rx_count==0),
agg_claim/er_claim,
avg_claim),
hospital_claim = ifelse((hospital_count>0)&(er_count*pcp_count*rx_count==0),
agg_claim/hospital_claim,
avg_claim),
pcp_claim = ifelse((pcp_count>0)&(er_count*hospital_count*rx_count==0),
agg_claim/pcp_claim,
avg_claim),
rx_claim = ifelse((rx_count>0)&(hospital_count*pcp_count*pcp_count==0),
agg_claim/rx_claim,
avg_claim))
er_claim = ifelse((er_count>0)&(hospital_count*pcp_count*rx_count==0),
agg_claim/er_claim,
avg_claim)
er_claim=0
er_claim = ifelse((er_count>0)&(hospital_count*pcp_count*rx_count==0),
agg_claim/er_claim,
avg_claim)
tmp = control
er_claim=0
hospital_claim=0
pcp_claim=0
rx_claim=0
er_claim = ifelse((er_count>0)&(hospital_count*pcp_count*rx_count==0),
agg_claim/er_claim,
avg_claim)
hospital_claim = ifelse((hospital_count>0)&(er_count*pcp_count*rx_count==0),
agg_claim/hospital_claim,
avg_claim)
pcp_claim = ifelse((pcp_count>0)&(er_count*hospital_count*rx_count==0),
agg_claim/pcp_claim,
avg_claim)
rx_claim = ifelse((rx_count>0)&(hospital_count*pcp_count*pcp_count==0),
agg_claim/rx_claim,
avg_claim)
tmp = tmp %>% cbind(er_claim,hospital_claim,pcp_claim,rx_claim)
log_claim = log(tmp$agg_claim)
tmp %>% ggplot() + geom_point(aes(x=time,y=log_claim,color=factor(er_count)),alpha=0.1)
tmp %>% ggplot() + geom_point(aes(x=time,y=log_claim,color=factor(hospital_count)),alpha=0.1)
tmp %>% ggplot() + geom_point(aes(x=time,y=log_claim,color=factor(rx_count)),alpha=0.3)
tmp %>% ggplot() + geom_point(aes(x=time,y=log_claim,color=factor(pcp_count)),alpha=0.3)
tmp = control
er_claim=0
hospital_claim=0
pcp_claim=0
rx_claim=0
er_claim = ifelse((er_count>0)&(hospital_count*pcp_count*rx_count==0),
agg_claim/er_claim,
avg_claim)
hospital_claim = ifelse((hospital_count>0)&(er_count*pcp_count*rx_count==0),
agg_claim/hospital_claim,
avg_claim)
pcp_claim = ifelse((pcp_count>0)&(er_count*hospital_count*rx_count==0),
agg_claim/pcp_claim,
avg_claim)
rx_claim = ifelse((rx_count>0)&(hospital_count*pcp_count*pcp_count==0),
agg_claim/rx_claim,
avg_claim)
tmp = tmp %>% cbind(er_claim,hospital_claim,pcp_claim,rx_claim)
log_claim = log(tmp$agg_claim)
tmp %>% ggplot() + geom_point(aes(x=time,y=log(er_claim),color=factor(er_count)),alpha=0.1)
tmp %>% ggplot() + geom_point(aes(x=time,y=log(hospital_claim),color=factor(hospital_count)),alpha=0.1)
tmp %>% ggplot() + geom_point(aes(x=time,y=log(rx_claim),color=factor(rx_count)),alpha=0.3)
tmp %>% ggplot() + geom_point(aes(x=time,y=log(pcp_claim),color=factor(pcp_count)),alpha=0.3)
tmp = control
er_claim=0
hospital_claim=0
pcp_claim=0
rx_claim=0
er_claim = ifelse((er_count>0)&(hospital_count*pcp_count*rx_count==0),
agg_claim/er_claim,
avg_claim)
hospital_claim = ifelse((hospital_count>0)&(er_count*pcp_count*rx_count==0),
agg_claim/hospital_claim,
avg_claim)
pcp_claim = ifelse((pcp_count>0)&(er_count*hospital_count*rx_count==0),
agg_claim/pcp_claim,
avg_claim)
rx_claim = ifelse((rx_count>0)&(hospital_count*pcp_count*pcp_count==0),
agg_claim/rx_claim,
avg_claim)
tmp = tmp %>% cbind(er_claim,hospital_claim,pcp_claim,rx_claim)
log_claim = log(tmp$agg_claim)
tmp %>% ggplot() + geom_point(aes(x=time,y=log(er_claim),color=factor(er_count)),alpha=0.1)+ ylim(4,10)
tmp %>% ggplot() + geom_point(aes(x=time,y=log(hospital_claim),color=factor(hospital_count)),alpha=0.1)+ ylim(4,10)
tmp %>% ggplot() + geom_point(aes(x=time,y=log(rx_claim),color=factor(rx_count)),alpha=0.3)+ ylim(4,10)
tmp %>% ggplot() + geom_point(aes(x=time,y=log(pcp_claim),color=factor(pcp_count)),alpha=0.3)+ ylim(4,10)
tmp %>% ggplot() + geom_point(aes(x=time,y=log(pcp_claim),color=factor(pcp_count)),alpha=0.3)+ ylim(4,11)
tmp = control
er_claim=0
hospital_claim=0
pcp_claim=0
rx_claim=0
er_claim = ifelse((er_count>0)&(hospital_count*pcp_count*rx_count==0),
agg_claim/er_claim,
avg_claim)
hospital_claim = ifelse((hospital_count>0)&(er_count*pcp_count*rx_count==0),
agg_claim/hospital_claim,
avg_claim)
pcp_claim = ifelse((pcp_count>0)&(er_count*hospital_count*rx_count==0),
agg_claim/pcp_claim,
avg_claim)
rx_claim = ifelse((rx_count>0)&(hospital_count*pcp_count*pcp_count==0),
agg_claim/rx_claim,
avg_claim)
tmp = tmp %>% cbind(er_claim,hospital_claim,pcp_claim,rx_claim)
log_claim = log(tmp$agg_claim)
tmp %>% ggplot() + geom_point(aes(x=time,y=log(er_claim),color=factor(er_count)),alpha=0.1)+ ylim(0,15)
tmp %>% ggplot() + geom_point(aes(x=time,y=log(hospital_claim),color=factor(hospital_count)),alpha=0.1)+ ylim(0,15)
tmp %>% ggplot() + geom_point(aes(x=time,y=log(rx_claim),color=factor(rx_count)),alpha=0.3)+ ylim(0,15)
tmp %>% ggplot() + geom_point(aes(x=time,y=log(pcp_claim),color=factor(pcp_count)),alpha=0.3)+ ylim(0,15)
tmp %>% ggplot() + geom_point(aes(x=time,y=log(er_claim),color=factor(er_count)),alpha=0.1)+ ylim(0,150)
sort(unique(log(tmp$er_claim)),descending=T)
sort(unique(log(tmp$er_claim)),decreasing =T)
sort((log(tmp$er_claim)),decreasing =T)
sort((log(tmp$avg_claim)),decreasing =T)
sort((log(tmp$avg_claim)),decreasing =T)
sort((log(tmp$agg_claim)),decreasing =T)
sort((log(tmp$er_claim)),decreasing =T)
sort(((tmp$er_claim)),decreasing =T)
sort(((tmp$er_claim)),decreasing =T)
tmp = control
er_claim=0
hospital_claim=0
pcp_claim=0
rx_claim=0
er_claim = ifelse((er_count>0)&(hospital_count*pcp_count*rx_count==0),
agg_claim/er_count,
avg_claim)
hospital_claim = ifelse((hospital_count>0)&(er_count*pcp_count*rx_count==0),
agg_claim/hospital_count,
avg_claim)
pcp_claim = ifelse((pcp_count>0)&(er_count*hospital_count*rx_count==0),
agg_claim/pcp_count,
avg_claim)
rx_claim = ifelse((rx_count>0)&(hospital_count*pcp_count*pcp_count==0),
agg_claim/rx_count,
avg_claim)
tmp = tmp %>% cbind(er_claim,hospital_claim,pcp_claim,rx_claim)
log_claim = log(tmp$agg_claim)
#sort(((tmp$er_claim)),decreasing =T)
tmp %>% ggplot() + geom_point(aes(x=time,y=log(er_claim),color=factor(er_count)),alpha=0.1)+ ylim(4,10)
tmp %>% ggplot() + geom_point(aes(x=time,y=log(hospital_claim),color=factor(hospital_count)),alpha=0.1)+ ylim(4,10)
tmp %>% ggplot() + geom_point(aes(x=time,y=log(rx_claim),color=factor(rx_count)),alpha=0.3)+ ylim(4,10)
tmp %>% ggplot() + geom_point(aes(x=time,y=log(pcp_claim),color=factor(pcp_count)),alpha=0.3)+ ylim(4,10)
